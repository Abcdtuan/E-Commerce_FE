<div class="product-detail-container" *ngIf="product">

  <div class="product-image-section" *ngIf="product && product.images?.length > 0">
    <button class="slider-btn left" (click)="prevImage()">&#10094;</button>

    <img [src]="product.images[currentImageIndex].processedImg" alt="img" class="product-image">

    <button class="slider-btn right" (click)="nextImage()">&#10095;</button>
    <div class="dots">
      <span *ngFor="let img of product.images; let i = index"
            [class.active]="i === currentImageIndex"
            (click)="currentImageIndex = i"></span>
    </div>
  </div>


  <div class="product-info-section">
    <div class="product-title-row">
      <h1 class="product-title">{{ product.name }}</h1>
    </div>

    <div class="product-stats">
      <div class="average-rating" *ngIf="product?.averageRating">
        <span *ngFor="let star of getStarArray(product.averageRating)" 
              class="star" 
              [class.filled]="star">
          ★
        </span>
        <span class="rating-number">{{ product.averageRating | number:'1.1-1' }}</span>
      </div>
      <span class="separator" *ngIf="product.averageRating && product.totalSold">|</span>
      <div class="total-sold" *ngIf="product.totalSold">
        <span>Đã bán: {{ product.totalSold }}</span>
      </div>
      <span class="separator" *ngIf="(product.averageRating || product.totalSold) && product.stockQuantity">|</span>
      <div class="stock-quantity" *ngIf="product.stockQuantity">
        <span>Còn lại: {{ product.remainingStock }}</span>
      </div>
    </div>

    <div class="product-price">
      <span class="price-current">{{ product.price | number:'1.0-0' }}₫</span>
      <span class="price-old" *ngIf="product.price">{{ product.price | number:'1.0-0' }}₫</span>
    </div>
    <div class="product-origin" *ngIf="product.origin">
      <span class="label">Xuất xứ:</span> {{ product.origin }}
    </div>

    <div class="product-brand" *ngIf="product.brandName">
      <span class="label">Thương hiệu:</span> {{ product.brandName }}
    </div>

    <div>
      <span>
        59 giải phóng, Hai Bà Trưng, Hà Nội - 0989400954
      </span>
    </div>
     
  

    <div class="category">
      <span>Danh mục:</span> {{ product.categoryName}}
    </div>
  </div>
</div>
<div class="product-description-section" *ngIf="product">
  <h2>Mô tả sản phẩm</h2>
  <p>{{ product.description }}</p>
</div>
<div class="reviews-section" *ngIf="reviewList && reviewList.length > 0">
  <div class="reviews-header">
    <h2>Đánh giá từ khách hàng</h2>
    <div class="average-rating-summary" *ngIf="product.averageRating">
      <span class="rating-number-large">{{ product.averageRating | number:'1.1-1' }}</span>
      <div class="stars-large">
        <span *ngFor="let star of getStarArray(product.averageRating)" 
              class="star" 
              [class.filled]="star">
          ★
        </span>
      </div>
      <span class="review-count">({{ reviewList.length }} đánh giá)</span>
    </div>
  </div>
  
  <div class="review-item" *ngFor="let review of reviewList">
    <div class="review-header">
      <div class="review-user">
        <span class="username">{{ review.userName }}</span>
        <span class="review-date">{{ review.date | date:'dd/MM/yyyy' }}</span>
      </div>
    </div>

    <div class="review-rating">
      <span *ngFor="let star of getStarArray(review.rating)" 
            class="star" 
            [class.filled]="star">
        ★
      </span>
    </div>
    <div class="review-description">
      <p>{{ review.description }}</p>
    </div>
    <div class="review-images" *ngIf="review.images && review.images.length > 0">
      <img *ngFor="let image of review.images" 
           [src]="image.processedReviewImg" 
           alt="Review image"
           class="review-image">
    </div>
  </div>
</div>

<div class="no-reviews" *ngIf="reviewList && reviewList.length === 0">
  <p>Chưa có đánh giá nào cho sản phẩm này.</p>
</div>